---
title: '試験的にコメント欄を作成します'
category:
  - 雑記
tags:
  - ブログ
  - NextJS
date: '2021-02-15'
commentId: 'wip'
---

## tl;dr

- このサイト(nzws.me/blog/\*)に試験的にコメント欄を作成します
- ActivityPub 対応サービスのアカウントから投稿できます(例: Mastodon, Misskey, Pleroma)
- 問題がありそうなら消します

## なんで？

自分の書いた事に対する意見や感想をもう少し手軽に見れたらなと思い作成しました。  
今まではコメントがあれば自分にリプしてスタイルだったのですが、
この方式だと中々直接は貰えない事が多いので、
各 SNS でブログ URL を検索して投稿してもらったものを空リプのような形で見てまわっていたのですが、
恐らくこの形式だと全て見切れてないだろうなという部分がありコメント欄作成の検討をしました。

しかし、Disqus などのサービスだとそれはそれでコメントの敷居が少し高そうだなというのと、
自分が気が付きにくそう（多分毎日見ない）というのと自由度が高くなさそうという所から考えて、

- コメントの敷居をなるべく低くする
- 自由度が高い（=自分で作れる）
- 毎日見れる

と考えた所、Mastodon の API そのまま流用するの案外良くね...？（KnzkLive スタイル）の結論に至り実装しました。  
まあ極端な話は単にリプライしてるだけなのですが「リプライがコメントとして機械的に処理される」という大義名分ができるとリプライしやすくなるのでは...？と目論んでいます。

## 細かい仕組みとか

自分が運営する Mastodon サーバー don.nzws.me から全部引っ張ってきていますが、API は NextJS の API Routes 機能を使用し独自の API を用意して間接的に使用するようにしています
（ちょっとキャッシュもしています）  
コメントするための投稿の ID は単純に記事のマークダウンのメタ情報に後から突っ込んでいるのですが、

- 記事作成&最初の PR 作成
- 本番サーバーに記事をデプロイ
- URL を投稿
- ID を確認してメタ情報に追加&PR 作成
- もう一度デプロイ

という結構面倒な事になっているので別途 Action を作ったりして改善したいなとは思っている所です。

## さいごに

この記事からコメント欄が使用できるようになっているはずなのでコメントくれると嬉しいです。（実装途中に書いてるのでどうなってるのかわからない）
